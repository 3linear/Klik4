// jQuery Routes v1.1
// http://routesjs.com/
// 
// Copyright (c) 2011 Syntacticx
// http://syntacticx.com/
// 
// Dual licensed under the MIT or GPL Version 2 licenses.
//
// jQuery Address Plugin v1.3.1
// http://www.asual.com/jquery/address/
// 
// Copyright (c) 2009-2010 Rostislav Hristov
// Dual licensed under the MIT or GPL Version 2 licenses.
// http://jquery.org/license
(function(d){d.address=function(){var G=function(a){d(d.address).trigger(d.extend(d.Event(a),function(){for(var c={},g=d.address.parameterNames(),k=0,D=g.length;k<D;k++)c[g[k]]=d.address.parameter(g[k]);return{value:d.address.value(),path:d.address.path(),pathNames:d.address.pathNames(),parameterNames:g,parameters:c,queryString:d.address.queryString()}}.call(d.address)))},A=function(a,c,g){d(d.address).bind(a,c,g);return d.address},B=function(){return N.pushState&&h.state!==m},E=function(){return("/"+
j.pathname.replace(RegExp(h.state),"")+j.search+(K()?"#"+K():"")).replace(pa,"/")},K=function(){var a=j.href.indexOf("#");return a!=-1?H(j.href.substr(a+1),p):""},y=function(){return B()?E():K()},w=function(a){a=a.toString();return(h.strict&&a.substr(0,1)!="/"?"/":"")+a},H=function(a,c){if(h.crawlable&&c)return(a!=""?"!":"")+a;return a.replace(/^\!/,"")},I=function(a,c){return parseInt(a.css(c),10)},aa=function(a){for(var c,g,k=0,D=a.childNodes.length;k<D;k++){if(a.childNodes[k].src)c=String(a.childNodes[k].src);
if(g=aa(a.childNodes[k]))c=g}return c},S=function(){if(!ga){var a=y(),c=i!=a;if(O&&u<523){if(X!=N.length){X=N.length;if(V[X-1]!==m)i=V[X-1];P(p)}}else if(c)if(Q&&u<7)j.reload();else{Q&&u<8&&h.history&&L(R,50);i=a;P(p)}}},P=function(a){G(qa);G(a?ra:sa);L(ba,10)},ba=function(){if(h.tracker!=="null"&&h.tracker!==null){var a=d.isFunction(h.tracker)?h.tracker:o[h.tracker],c=(j.pathname+j.search+(d.address&&!B()?d.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(d.isFunction(a))a(c);else if(d.isFunction(o.urchinTracker))o.urchinTracker(c);
else if(o.pageTracker!==m&&d.isFunction(o.pageTracker._trackPageview))o.pageTracker._trackPageview(c);else o._gaq!==m&&d.isFunction(o._gaq.push)&&o._gaq.push(["_trackPageview",c])}},R=function(){var a="javascript:"+p+";document.open();document.writeln('<html><head><title>"+s.title.replace("'","\\'")+"</title><script>var "+z+' = "'+encodeURIComponent(y())+(s.domain!=j.host?'";document.domain="'+s.domain:"")+"\";<\/script></head></html>');document.close();";if(u<7)t.src=a;else t.contentWindow.location.replace(a)},
v=function(){if(ca&&ta!=-1){var a,c=ca.substr(ta+1).split("&");for(J=0;J<c.length;J++){a=c[J].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(a[0]))h[a[0]]=isNaN(a[1])?/^(true|yes)$/i.test(a[1]):parseInt(a[1],10)!==0;if(/^(state|tracker)$/.test(a[0]))h[a[0]]=a[1]}ca=null}i=y()},T=function(){if(!ua){ua=q;v();var a=function(){Y.call(this);e.call(this)},c=d("body").ajaxComplete(a);a();if(h.wrap){d("body > *").wrapAll('<div style="padding:'+(I(c,"marginTop")+I(c,"paddingTop"))+"px "+
(I(c,"marginRight")+I(c,"paddingRight"))+"px "+(I(c,"marginBottom")+I(c,"paddingBottom"))+"px "+(I(c,"marginLeft")+I(c,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+z+'" style="height:100%;overflow:auto;position:relative;'+(O?window.statusbar.visible&&!/chrome/i.test(ia)?"":"resize:both;":"")+'" />');d("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});O&&d('<style type="text/css" />').appendTo("head").text("#"+z+"::-webkit-resizer { background-color: #fff; }")}if(Q&&u<
8){a=s.getElementsByTagName("frameset")[0];t=s.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",t);a[a.cols?"cols":"rows"]+=",0";t.noResize=q;t.frameBorder=t.frameSpacing=0}else{t.style.display="none";t.style.width=t.style.height=0;t.tabIndex=-1;s.body.insertAdjacentElement("afterBegin",t)}L(function(){d(t).bind("load",function(){var g=t.contentWindow;i=g[z]!==m?g[z]:"";if(i!=y()){P(p);j.hash=H(i,q)}});t.contentWindow[z]===m&&R()},50)}else if(O){if(u<418){d(s.body).append('<form id="'+
z+'" style="position:absolute;top:-9999px;" method="get"></form>');ja=s.getElementById(z)}if(j[z]===m)j[z]={};if(j[z][j.pathname]!==m)V=j[z][j.pathname].split(",")}L(function(){G("init");P(p)},1);if(!B())if(Q&&u>7||!Q&&"on"+da in o)if(o.addEventListener)o.addEventListener(da,S,p);else o.attachEvent&&o.attachEvent("on"+da,S);else za(S,50)}},Y=function(){var a,c=d("a"),g=c.size(),k=-1;L(function(){if(++k!=g){a=d(c.get(k));a.is("[rel*=address:]")&&a.address();L(arguments.callee,1)}},1)},U=function(){if(i!=
y()){i=y();P(p)}},b=function(){if(o.removeEventListener)o.removeEventListener(da,S,p);else o.detachEvent&&o.detachEvent("on"+da,S)},e=function(){if(h.crawlable){var a=j.pathname.replace(/\/$/,"");d("body").html().indexOf("_escaped_fragment_")!=-1&&d("a[href]:not([href^=http]), , a[href*="+document.domain+"]").each(function(){var c=d(this).attr("href").replace(/^http:/,"").replace(RegExp(a+"/?$"),"");if(c==""||c.indexOf("_escaped_fragment_")!=-1)d(this).attr("href","#"+d.address.decode(c.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,
"!$2")))})}},f=function(a){return va(ka(a)).replace(/%20/g,"+")},l=function(a){return a.split("#")[0].split("?")[0]},x=function(a){a=l(a);var c=a.replace(pa,"/").split("/");if(a.substr(0,1)=="/"||a.length===0)c.splice(0,1);a.substr(a.length-1,1)=="/"&&c.splice(c.length-1,1);return c},C=function(a){a=a.split("?");return a.slice(1,a.length).join("?").split("#")[0]},r=function(a,c){if(c=C(c)){params=c.split("&");var g=[];for(J=0;J<params.length;J++){var k=params[J].split("=");if(k[0]==a||d.address.decode(k[0])==
a)g.push(k.slice(1).join("="))}if(g.length!==0)return g.length!=1?g:g[0]}},W=function(a){var c=C(a);a=[];if(c&&c.indexOf("=")!=-1){c=c.split("&");for(var g=0;g<c.length;g++){var k=c[g].split("=")[0];d.inArray(k,a)==-1&&a.push(k)}}return a},M=function(a){a=a.split("#");return a.slice(1,a.length).join("#")},m,z="jQueryAddress",da="hashchange",qa="change",ra="internalChange",sa="externalChange",q=true,p=false,h={autoUpdate:q,crawlable:p,history:q,strict:q,wrap:p},F=d.browser,u=parseFloat(d.browser.version),
wa=F.mozilla,Q=F.msie,xa=F.opera,O=F.webkit||F.safari,la=p,o;try{o=top.document!==m?top:window}catch(Ca){o=window}var s=o.document,N=o.history,j=o.location,za=setInterval,L=setTimeout,va=encodeURIComponent,ka=decodeURIComponent,pa=/\/{2,9}/g,ia=navigator.userAgent,t,ja,ca=aa(document),ta=ca?ca.indexOf("?"):-1,ma=s.title,X=N.length,ga=p,ua=p,na=q,ya=q,ha=p,V=[],i=y();if(Q){u=parseFloat(ia.substr(ia.indexOf("MSIE")+4));if(s.documentMode&&s.documentMode!=u)u=s.documentMode!=8?7:8;d(document).bind("propertychange",
function(){if(s.title!=ma&&s.title.indexOf("#"+y())!=-1)s.title=ma})}if(la=wa&&u>=1||Q&&u>=6||xa&&u>=9.5||O&&u>=312){for(var J=1;J<X;J++)V.push("");V.push(i);if(xa)history.navigationMode="compatible";if(document.readyState=="complete")var Aa=setInterval(function(){if(d.address){T();clearInterval(Aa)}},50);else{v();d(T)}F=E();if(h.state!==m)if(N.pushState)F.substr(0,3)=="/#/"&&j.replace(h.state.replace(/^\/$/,"")+F.substr(2));else F!="/"&&F.replace(/^\/#/,"")!=K()&&j.replace(h.state.replace(/^\/$/,
"")+"/#"+F);d(window).bind("popstate",U).bind("unload",b)}else!la&&K()!=""||O&&u<418&&K()!=""&&j.search!=""?j.replace(j.href.substr(0,j.href.indexOf("#"))):ba();return{bind:function(a,c,g){return A(a,c,g)},init:function(a){return A("init",a)},change:function(a){return A(qa,a)},internalChange:function(a){return A(ra,a)},externalChange:function(a){return A(sa,a)},baseURL:function(){var a=j.href;if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},autoUpdate:function(a){if(a!==
m){h.autoUpdate=a;return this}return h.autoUpdate},crawlable:function(a){if(a!==m){h.crawlable=a;return this}return h.crawlable},history:function(a){if(a!==m){h.history=a;return this}return h.history},state:function(a){if(a!==m){h.state=a;return this}return h.state},strict:function(a){if(a!==m){h.strict=a;return this}return h.strict},tracker:function(a){if(a!==m){h.tracker=a;return this}return h.tracker},wrap:function(a){if(a!==m){h.wrap=a;return this}return h.wrap},update:function(){ha=q;this.value(i);
ha=p;return this},encode:function(a){var c=x(a),g=W(a),k=C(a),D=M(a),Z=a.substr(0,1),$=a.substr(a.length-1),n="";d.each(c,function(ea,fa){n+="/"+f(fa)});if(k!==""){n+="?";if(g.length===0)n+=k;else{d.each(g,function(ea,fa){var oa=r(fa,a);if(typeof oa!=="string")d.each(oa,function(Da,Ba){n+=f(fa)+"="+f(Ba)+"&"});else n+=f(fa)+"="+f(oa)+"&"});n=n.substr(0,n.length-1)}}if(D!=="")n+="#"+f(D);if(Z!="/"&&n.substr(0,1)=="/")n=n.substr(1);if(Z=="/"&&n.substr(0,1)!="/")n="/"+n;if(/#|&|\?/.test($))n+=$;return n},
decode:function(a){if(a!==m){var c=[];if(typeof a=="object"&&a.length!==m){for(var g=0,k=a.length;g<k;g++)c[g]=ka(a[g].toString().replace(/\+/g,"%20"));return c}else return ka(a.toString().replace(/\+/g,"%20"))}},title:function(a){if(a!==m){L(function(){ma=s.title=a;if(ya&&t&&t.contentWindow&&t.contentWindow.document){t.contentWindow.document.title=a;ya=p}if(!na&&wa)j.replace(j.href.indexOf("#")!=-1?j.href:j.href+"#");na=p},50);return this}return s.title},value:function(a){if(a!==m){a=this.encode(w(a));
if(a=="/")a="";if(i==a&&!ha)return;na=q;i=a;if(h.autoUpdate||ha){P(q);if(B())N[h.history?"pushState":"replaceState"]({},"",h.state.replace(/\/$/,"")+(i==""?"/":i));else{ga=q;V[N.length]=i;if(O)if(h.history){j[z][j.pathname]=V.toString();X=N.length+1;if(u<418){if(j.search==""){ja.action="#"+H(i,q);ja.submit()}}else if(u<523||i==""){a=s.createEvent("MouseEvents");a.initEvent("click",q,q);var c=s.createElement("a");c.href="#"+H(i,q);c.dispatchEvent(a)}else j.hash="#"+H(i,q)}else j.replace("#"+H(i,q));
else if(i!=y())if(h.history)j.hash="#"+H(i,q);else j.replace("#"+H(i,q));Q&&u<8&&h.history&&L(R,50);if(O)L(function(){ga=p},1);else ga=p}}return this}if(!la)return null;return this.decode(w(i))},path:function(a){if(a!==m){var c=C(w(i)),g=M(w(i));this.value(a+(c?"?"+c:"")+(g?"#"+g:""));return this}return this.decode(l(w(i)))},pathNames:function(){return this.decode(x(w(i)))},queryString:function(a){if(a!==m){var c=M(w(i));this.value(this.path()+(a?"?"+a:"")+(c?"#"+c:""));return this}return this.decode(C(w(i)))},
parameter:function(a,c,g){var k,D;if(c!==m){var Z=this.parameterNames();D=[];c=c?va(c):"";for(k=0;k<Z.length;k++){var $=Z[k],n=this.parameter($);if(typeof n=="string")n=[n];if($==a)n=c===null||c===""?[]:g?n.concat([c]):[c];for(var ea=0;ea<n.length;ea++)D.push($+"="+f(n[ea]))}d.inArray(a,Z)==-1&&c!==null&&c!==""&&D.push(a+"="+f(c));this.queryString(D.join("&"));return this}return this.decode(r(a,w(i)))},parameterNames:function(){return this.decode(W(w(i)))},hash:function(a){if(a!==m){this.value(w(i).split("#")[0]+
(a?"#"+a:""));return this}return this.decode(M(w(i)))}}}();d.fn.address=function(G){if(!d(this).attr("address")){var A=function(B){if(d(this).is("a")){var E=G?G.call(this):/address:/.test(d(this).attr("rel"))?d(this).attr("rel").split("address:")[1].split(" ")[0]:d.address.state()!==undefined&&d.address.state()!="/"?d(this).attr("href").replace(RegExp("^(.*"+d.address.state()+"|\\.)"),""):d(this).attr("href").replace(/^(#\!?|\.)/,"");d.address.value(E);B.preventDefault()}};d(this).click(A).live("click",
A).submit(function(B){if(d(this).is("form")){var E=G?G.call(this):d(this).attr("action")+"?"+d.address.decode(d(this).serialize());d.address.value(E);B.preventDefault()}}).attr("address",true)}return this}})(jQuery);
(function(d,G){function A(b,e){for(var f=0;f<v.length;++f)if(v[f][1]==b)return aa(v[f][0],e);return false}function B(){var b=window.location.href.split("#");return b[1]&&(b[1].match(/^\//)||b[1]=="")?b[1]:""}function E(b,e){var f=K(b),l=b!=Y;if(!l&&e==true)l=true;if(U&&l&&f){f[0]=y(f[0],f[2]);"callOriginal"in f[0]||S(b);d.routes.history.push([b,f[0],f[1]]);d.routes.dispatcher(f[0],f[1],b);return true}else return false}function K(b){for(var e=0;e<v.length;++e)if(v[e][0]==b)return[y(v[e][1],e),{},e];
for(e=0;e<T.length;++e){var f=T[e][0].exec(b);if(f){b={};for(var l=0;l<T[e][1].length;++l)b[T[e][1][l]]=f[(l+1)*3-1];return[y(v[e][1],e),b,e]}}return false}function y(b,e){if(typeof b=="string"&&typeof e=="undefined"){for(var f=0;f<v.length;++f)if(v[f][1]==b){e=f;break}throw"Method "+b+" not found in specified routes.";}if(typeof b=="function")return b;var l=v[e][0],x=b.match(/\#(.+)$/);x=x?x[1]:"set";var C=b.replace(/\#.+$/,"").split("."),r=G[C[0]];for(f=1;f<C.length;++f)r=r[C[f]];if(typeof r===
"undefined")throw'Could not find the object "'+C.join(".")+'"';r=r.instance();if(typeof r[x]==="undefined")throw'The method "'+x+'" does not exist for the route "'+l+'"';if("callOriginal"in r[x])return r[x];var W=r[x];r[x]=function(M){S(aa(l,M));W.apply(r,arguments)};r[x].callOriginal=function(){return W.apply(r,arguments)};return r[x]}function w(){if(!ba&&!R)ba=d(document).ready(function(){d.address.bind("externalChange",P);U=R=true;E(B(),true)||E("/")});else U=R=true}function H(b){for(var e in b){var f=
e;v.push([f,b[e]]);T.push(I(f))}w()}function I(b){var e=[];b=String(b);b=b.replace(/\((\:?[\w]+)\)/g,function(f,l){return""+l+"?"});b=b.replace(/\:([\w]+)(\/?)/g,function(f,l){e.push(l);return"(([\\w]+)(/|$))"});b=b.replace(/\)\?\/\(/g,")?(");if(b.match(/\*/)){e.push("path");b=b.replace(/\*/g,"((.+$))?")}return[RegExp("^"+b+"$"),e]}function aa(b,e){e=e||{};if(typeof e=="string"&&b.match(/\*/))b=b.replace(/\*/,e).replace(/\/\//g,"/");else{if(e.path)b=b.replace(/\*/,e.path.replace(/^\//,""));var f=
RegExp("(\\()?\\:([\\w]+)(\\))?(/|$)","g"),l;for(l in e)if(l!="path")b=b.replace(f,function(x,C,r,W,M){return r==l?e[l]+M:(C||"")+":"+r+(W||"")+M})}return b=b.replace(/\([^\)]+\)/g,"")}function S(b){if(U)if(Y!=b){d.address.value(b);Y=b}}function P(){if(U){var b=B();R&&b!=Y&&E(b)}}if(Number(d.fn.jquery.replace(/\./g))<143)throw"jQuery Routes requires jQuery 1.4.3 or later.";d.routes=function(b,e,f){if(typeof d.address=="undefined")throw"jQuery Address (http://www.asual.com/jquery/address/) is required to run jQuery View Routes";
if(typeof b=="function")d.address.bind("externalChange",function(){v(window.location.href.match("#")?window.location.href.split("#").pop():"")});else if(b===false)d(d.address).unbind("externalChange");else if(typeof b=="string"){if(b=="start")return w();if(b=="stop")U=false;else{if(b=="match")return K(e);if(b=="set")return E(e);if(b=="get")return B();if(b=="url")return A(e,f);if(b=="setup")return A(e);if(b=="add")return A(e,f);throw b+" is not a supported method.";}}else{for(var l in b)if(typeof b[l]===
"string"&&!b[l].match(/(\#|\.)/))b[l]+="#set";H(b);if(!e)for(b=0;b<v.length;++b)y(v[b][1],b)}};d.routes.dispatcher=function(b,e){b(e)};d.routes.history=[];var ba=false,R=false,v=[],T=[],Y=false,U=false})(jQuery,this);
